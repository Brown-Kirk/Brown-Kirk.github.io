<html>
  <head>
    <meta content = "text/html; charset = ISO-8859-1" http-equiv = "content-type">
    <script type = "application/javascript">
      function getFileFromServer(url, divId, isJSON){
      	var xmlhttp = new XMLHttpRequest();
      	xmlhttp.onreadystatechange =
      			function()
      			{	//	This code is not executed immedidaitely. It is call later when the server starts to respond.
      				if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
      					doSomethingWithTheResponse(xmlhttp.responseText, divId, isJSON);
      			}
      	xmlhttp.open("GET", url, true);
      	xmlhttp.send();
      }
      function doSomethingWithTheResponse(response, divId, isJSON) {
      	var responseText = (isJSON) ? JSON.parse(response) : response;
      	if (isJSON) {
      		document.getElementById( divId+"2" ).innerHTML = "Just the text<BR>" + response;
      		document.getElementById( divId ).innerHTML = "Fields from the JSON Object<BR>" +
      			"User Name: " + responseText.user.name + "<BR>" +
      			"JSON is just Key:value pairs - " + responseText.thisIsTheKey + "<BR>";
      		document.getElementById( divId ).style.color = responseText.color;
      	}
      	else {
      		var launchURLValue = responseText;
      	}
        loadJSON(launchURLValue);
      }
      function loadJSON(data_file){
        //var data_file = "https://launchlibrary.net/1.3/launch/next/5";
        var http_request = new XMLHttpRequest();
        try{
          http_request = new XMLHttpRequest();
        }
        catch (e){
          try{
            http_request = new ActiveXObject("Msxml2.XMLHTTP");
          }
          catch (e) {
            try{
              http_request = new ActiveXObject("Microsoft.XMLHTTP");
            }
            catch (e){
              alert("Well, crap... That wasn't supposed to happen.");
              return false;
            }
          }
        }

        http_request.onreadystatechange = function(){
          if (http_request.readyState == 4  ){
            var jsonObj = JSON.parse(http_request.responseText);
            //document.getElementById( "central" ).innerHTML = "";
            for(var i in jsonObj.launches) {
              sessionStorage.setItem("launchcount",i);
              var launchnumber = jsonObj.launches[i].id;
              var launchelementID = "launchchoice" + i;
              var launchElementDivs = document.getElementById(launchelementID);
              if (launchElementDivs != null) {
                launchElementDivs.parentNode.removeChild(launchDetailDiv);
              }
              var detailsDiv = document.getElementById('details');
              if (detailsDiv != null) {
                detailsDiv.parentNode.removeChild(detailsDiv);
              }
              var launchurl = "'https://launchlibrary.net/1.3/launch/" + launchnumber + "'";
              var div = document.createElement('div');
              div.id = launchelementID;
              div.innerHTML = "Launch: " + launchnumber + " Date: " + jsonObj.launches[i].windowstart + ' <button type = "button" onclick = "loadSecondJSON(' + launchurl + ')">See Details </button> <br><br>';
              document.body.appendChild(div);
            }
          }
        }
        http_request.open("GET", data_file, true);
        http_request.send();
      }

      function loadSecondJSON(launchurl){
        var data_file = launchurl;
        var http_request = new XMLHttpRequest();
        try{
          // Opera 8.0+, Firefox, Chrome, Safari
          http_request = new XMLHttpRequest();
        }
        catch (e){
          try{
            http_request = new ActiveXObject("Msxml2.XMLHTTP");
          }
          catch (e) {
            try{
              http_request = new ActiveXObject("Microsoft.XMLHTTP");
            }
            catch (e){
              alert("Well, crap... That wasn't supposed to happen.");
              return false;
            }
          }
        }
        http_request.onreadystatechange = function(){
          if (http_request.readyState == 4  ){
            var jsonObj2 = JSON.parse(http_request.responseText);
            //var elem = document.getElementById("central");
            //elem.parentNode.removeChild(elem);
            var launchcount = sessionStorage.getItem("launchcount");
            do {
              var launchelementID = "launchchoice" + launchcount;
              var elem = document.getElementById(launchelementID);
              elem.parentNode.removeChild(elem);
              launchcount--;
            }
            while (launchcount >= 0);
            var launchstart = jsonObj2.launches[0].windowstart;
            var launchend = jsonObj2.launches[0].windowend;
            var launchwindowfull = launchstart + " - " + launchend;
            var launchsite = jsonObj2.launches[0].location.pads[0].name;
            var rocketname = jsonObj2.launches[0].rocket.name;
            var rocketagency = jsonObj2.launches[0].rocket.agencies[0].name;
            var mission = jsonObj2.launches[0].missions[0].name;
            var missiondetails = jsonObj2.launches[0].missions[0].description;
            var rawJSON = JSON.stringify(jsonObj2);
            var launchWindowDetail = '<h3>Launch Window</h3><p>' + launchwindowfull + '</p>';
            var launchSiteDetail = '<h3>Launch Site</h3><p>' + launchsite + '</p>';
            var rocketNameDetail = '<h3>Rocket Name</h3><p>' + rocketname + '</p>';
            var rocketOwnerDetail = '<h3>Rocket Owner</h3><p>' + rocketagency + '</p>';
            var missionNameDetails = '<h3>Mission Name</h3><p>' + mission + '</p>';
            var missionDescDetails = '<h3>Mission Details</h3><p>' + missiondetails + '</p>';
            var rawJSONvalue = '<h3>Raw JSON Values</h3><p>' + rawJSON + '</p>';
            var newDivValues = launchWindowDetail + launchSiteDetail + rocketNameDetail + rocketOwnerDetail + missionNameDetails + missionDescDetails + rawJSONvalue;
            var div = document.createElement('div');
            div.id = "details";
            div.innerHTML = newDivValues;
            document.body.appendChild(div);
          }
        }
        http_request.open("GET", data_file, true);
        http_request.send();
      }
    </script>
    <title>JSON Demonstration</title>
  </head>
  <body>
    <h1>JSON retrieval</h1>
    <p>This page retrieves information from https://launchlibrary.net as JSON file, then parses that file to provide various details. A demonstration of using stringify to display the raw JSON follows the detail sections.</p>
    <div id = "central">
      <p>Click the "Update Details" button to display the next 5 launches.
      <button type = "button" onclick = "loadJSON()">Update Details </button>
    </div>
</body>
</html>
